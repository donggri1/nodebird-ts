나는 초보개발자야 코드생성할때 주석도 같이달아
# 실시간 채팅 기능 구현 계획

**목표:** 로그인한 모든 사용자가 어느 페이지에서든 접근할 수 있는 전역 실시간 채팅 기능 구현

**핵심 구현 전략:**

### 1. 서버 측 (Backend)
*   **`socket.io` 라이브러리 추가:** 실시간 양방향 통신을 위해 `socket.io` 패키지를 설치합니다.
*   **`socket.ts` 모듈 생성:** `gifchat`의 `socket.js`와 같이, 웹소켓 관련 로직을 전담할 `socket.ts` 파일을 생성합니다. 이 파일은 다음을 처리합니다.
    *   **인증 연동:** `socket.io` 미들웨어를 사용하여 `express-session`에 접근합니다. 이를 통해 웹소켓 연결 요청 시, 로그인한 사용자인지 판별하고 사용자 정보를 소켓과 연결합니다. 비로그인 사용자의 접근은 차단합니다.
    *   **이벤트 핸들링:**
        *   `connection`: 사용자가 접속하면, 다른 모든 사용자에게 "OOO님이 입장하셨습니다" 메시지를 보냅니다.
        *   `disconnect`: 사용자 접속이 끊어지면, "OOO님이 퇴장하셨습니다" 메시지를 보냅니다.
        *   `chat`: 특정 사용자가 보낸 채팅 메시지를 받아서, 접속해 있는 모든 사용자에게 메시지 내용과 보낸 사용자 정보를 전달합니다.
*   **`app.ts` 와 통합:** `app.ts`에서 `http` 서버를 생성하고, 이 서버를 `socket.ts` 모듈에 넘겨 `socket.io` 서버를 실행시킵니다. 기존 `express` 앱과 `socket.io`가 같은 포트를 공유하게 됩니다.

### 2. 클라이언트 측 (Frontend)
*   **`views/layout.html` 수정:** 모든 페이지에 공통으로 적용되는 `layout.html` 파일에 채팅창 UI를 추가합니다. 이렇게 하면 어떤 페이지를 방문하더라도 항상 화면 오른쪽에 채팅창이 표시됩니다.
*   **CSS 추가:** `public/main.css`에 채팅창을 화면 우측 하단에 고정시키고, 다른 콘텐츠를 가리지 않도록 스타일을 추가합니다.
*   **클라이언트 스크립트 작성:** `layout.html`에 `<script>` 태그를 추가하여 다음 로직을 구현합니다.
    *   서버의 `socket.io`에 접속합니다.
    *   채팅 입력창에서 메시지를 전송하면, `socket.emit('chat', ...)`을 통해 서버로 메시지를 보냅니다.
    *   서버로부터 `chat`, `join`, `exit` 등의 이벤트를 수신(`socket.on(...)`)하여, 수신된 메시지를 채팅창에 동적으로 추가하여 보여줍니다.

### 3. 개발 진행 순서
1.  `npm install socket.io` 명령어로 의존성을 추가합니다.
2.  서버 로직을 담을 `socket.ts` 파일을 생성하고, 인증 및 기본 이벤트 핸들러를 작성합니다.
3.  `app.ts`를 수정하여 `socket.io` 서버를 초기화하고 실행합니다.
4.  `views/layout.html`에 채팅창 HTML 구조를 추가합니다.
5.  `public/main.css`에 채팅창 스타일을 추가합니다.
6.  `views/layout.html`에 서버와 통신하고 UI를 조작하는 클라이언트 JavaScript 코드를 작성합니다.
